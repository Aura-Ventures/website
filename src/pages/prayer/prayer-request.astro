---
import type { MetaData } from '~/types';
import Layout from '../../layouts/Layout.astro';

const metadata: MetaData = {
  title: 'My Prayer Request',
};
---

<Layout metadata={metadata}>
  <div class='prayer-container'>
    <div class='prayer-card'>
      <div class='header'>
        <div class='from-section'>
          <span class='avatar'>H</span>
          <span class='from-text'>From Herman</span>
          <!-- <span class='close-icon'>×</span> -->
        </div>
      </div>
      <div class='content'>
        <div class='qr-section'>
          <div class='qr-code'></div>
          <div class='brand'>
            <div class='brand-name'>Aura</div>
            <div class='brand-slogan'>Pray Deeper | Walk Closer</div>
          </div>
        </div>

        <div class='prayer-content-card-container'>
          <div class='prayer-content-card'>
            <div class='author-section'>
              <span class='author-avatar'>H</span>
              <span class='author-name'>Herman</span>
              <span class='new-badge'>NEW</span>
            </div>

            <h1 class='prayer-title'>Pray for Kate's Healing and Family Support</h1>
            <div class='timestamp'>10:12PM Oct 24, 2024</div>

            <p class='prayer-content'>
              My wife just recently got diagnosed with an aggressive form of breast cancer. Please join me in prayer for
              God's mercy on our family and for Kate to have more time on earth for the Kingdom work. Please pray that
              we experience God's presence throughout this season, and that we do not lose faith. I pray for for
              surrendered hearts that rejoice in the Lord's faithfulness, regardless of the outcome, but I plead for
              complete healing and recovery for Kate.
            </p>

            <button class='join-prayer-btn' id='prayerButton'>Join Me In Prayer</button>

            <div class='prayer-stats'>
              <div class='avatar-group'>
                <div class='avatar-stack'>
                  <img class='avatar-img' src='https://avatar.iran.liara.run/public' alt='avatar' />
                  <img class='avatar-img' src='https://avatar.iran.liara.run/public' alt='avatar' />
                  <img class='avatar-img' src='https://avatar.iran.liara.run/public' alt='avatar' />
                </div>
              </div>
              <span class='prayer-count'>6 people prayed</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    .prayer-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 16px;
      font-family:
        'Jost',
        -apple-system,
        BlinkMacSystemFont,
        'Segoe UI',
        Roboto,
        sans-serif;
    }

    .prayer-card {
      background: #ece9e2;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .header {
    }

    .content {
      padding: 0 16px 16px 16px;
    }

    .from-section {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fbfaf3;
      padding: 16px;
    }

    .avatar {
      width: 24px;
      height: 24px;
      background: #e2e2e2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .from-text {
      color: #666;
      font-size: 14px;
    }

    .close-icon {
      margin-left: auto;
      color: #999;
      font-size: 20px;
      cursor: pointer;
    }

    .qr-section {
      background: #ece9e2;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      border-radius: 8px;
    }

    .qr-code {
      width: 55px;
      height: 55px;
      background: #fff;
      border-radius: 4px;
    }

    .brand {
      flex: 1;
      text-align: right;
    }

    .brand-name {
      font-family: 'BeautiqueDisplayCondensed', serif;
      font-weight: 500;
      color: #222;
      font-size: 24px;
      margin-bottom: 4px;
    }

    .brand-slogan {
      color: #4f4f4f;
      font-size: 14px;
    }

    .prayer-content-card-container {
      /* padding: 14px; */
    }

    .prayer-content-card {
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 12px;
      border-radius: 12px;
      background: white;
    }

    .author-section {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    .author-avatar {
      width: 20px;
      height: 20px;
      background: #e2e2e2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .author-name {
      font-weight: 700;
      font-size: 12px;
      color: #000;
    }

    .new-badge {
      margin-left: auto;
      background: #bd3a54;
      color: white;
      padding: 1px 6px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .prayer-title {
      font-family: 'Jost', sans-serif;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #4f4f4f;
    }

    .timestamp {
      color: #8d8d8d;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .prayer-content {
      font-family: 'Jost', sans-serif;
      font-size: 16px;
      color: #4f4f4f;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .join-prayer-btn {
      font-family: 'Jost', sans-serif;
      width: 100%;
      background: #363636;
      color: white;
      border: none;
      padding: 14px 12px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 20px;
    }

    .prayer-stats {
      display: flex;
      align-items: center;
      padding-left: 24px;
      gap: 8px;
      border-top: 1px solid #e2e2e2;
      padding-top: 12px;
    }

    .avatar-stack {
      display: flex;
      margin-right: 8px;
    }

    .avatar-img {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-left: -4px;
    }

    .prayer-count {
      color: #666;
      font-size: 14px;
    }

    @media (max-width: 480px) {
      .prayer-container {
        padding: 0;
      }

      .prayer-card {
        border-radius: 0;
      }

      .qr-section {
        margin-left: -16px;
        margin-right: -16px;
        border-radius: 0;
      }
    }
  </style>

  <script>
    document.getElementById('prayerButton')?.addEventListener('click', () => {
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const isAndroid = /Android/.test(navigator.userAgent);
      const appStoreUrl = 'https://apps.apple.com/us/app/aura-personal-bible-prayer/id6736381898';
      const playStoreUrl = 'https://play.google.com/store/apps/details?id=com.aura.letspray';
      const appDeepLink = 'aura://group/prayer-requests';

      // 记录当前时间
      const startTime = Date.now();

      // 尝试打开应用
      window.location.href = appDeepLink;

      // 监听页面可见性变化
      document.addEventListener('visibilitychange', function () {
        // 如果页面变为隐藏状态（应用被打开），且时间间隔小于2秒
        if (document.hidden && Date.now() - startTime < 2000) {
          // 应用已安装并成功打开
          return;
        }

        // 如果页面仍然可见，说明应用未安装
        if (!document.hidden) {
          // 跳转到应用商店
          if (isIOS) {
            window.location.href = appStoreUrl;
          } else if (isAndroid) {
            window.location.href = playStoreUrl;
          }
        }
      });
    });
  </script>
</Layout>
